<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Days Completed</title>

<style>
/* --- SAME UI STYLES (UNCHANGED) --- */
:root {
  --bg:#0b0e13;--card:#1c212c;--card-done:#202a1f;
  --header-card:#151922;--footer-card:#141824;
  --text:#fff;--muted:#9aa0a6;--accent:#9eff6a;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh;display:flex;justify-content:center}
.app{width:100%;max-width:420px;height:100vh;display:flex;flex-direction:column}
.header{padding:14px}
.header-card{background:var(--header-card);border-radius:20px;padding:16px;display:flex;justify-content:space-between}
.content{flex:1;min-height:0;overflow-y:auto;padding:10px 14px}
.card{background:var(--card);border-radius:18px;padding:14px 16px;margin-bottom:12px;display:flex;justify-content:space-between;cursor:pointer}
.card.completed{background:var(--card-done)}
.badge{color:var(--accent);opacity:0}
.card.completed .badge{opacity:1}
.footer{padding:14px}
.footer-card{background:var(--footer-card);border-radius:16px;padding:14px;color:var(--muted);border-left:3px solid var(--accent)}
.login{height:100vh;display:flex;align-items:center;justify-content:center}
.login-box{background:var(--header-card);padding:24px;border-radius:16px;width:90%;max-width:320px}
.login-box input{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none}
.login-box button{width:100%;padding:10px;border-radius:10px;border:none;background:var(--accent);font-weight:700}
#error{color:#ff6a6a;font-size:12px;margin-top:10px}
</style>
</head>

<body>

<div class="login" id="login">
  <div class="login-box">
    <h2>Private Access</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn">Enter</button>
    <p id="error"></p>
  </div>
</div>

<div class="app" id="app" style="display:none">
  <div class="header">
    <div class="header-card">
      <div>
        <h1>Hello, Chethan Kumar</h1>
        <p style="color:var(--muted)">Journey started Jan 01, 2026</p>
      </div>
      <div>
        <div id="count" style="font-size:26px;color:var(--accent)">0</div>
        <div style="font-size:12px;color:var(--muted)">Days Completed</div>
      </div>
    </div>
  </div>

  <div class="content" id="list"></div>

  <div class="footer">
    <div class="footer-card">‚ÄúYou don‚Äôt need motivation. You need consistency.‚Äù</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, deleteDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  setPersistence,
  browserLocalPersistence
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC2eBGQa-QrmzzabyGabU6e3vt9UomlI7c",
  authDomain: "completed-days.firebaseapp.com",
  projectId: "completed-days",
  appId: "1:137286997518:web:221c7010e09d014bc28e5f"
};

const appFB = initializeApp(firebaseConfig);
const db = getFirestore(appFB);
const auth = getAuth(appFB);

/* üîê FORCE SESSION PERSISTENCE */
await setPersistence(auth, browserLocalPersistence);

/* LOGIN */
loginBtn.onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, email.value, password.value);
  } catch {
    error.textContent = "Invalid credentials";
  }
};

/* AUTH GATE ‚Äî NOTHING RUNS BEFORE THIS */
onAuthStateChanged(auth, user => {
  if (!user) return;
  login.style.display = "none";
  app.style.display = "flex";
  startApp();
});

/* APP LOGIC */
const START_DATE = new Date("2026-01-01");
const TOTAL_DAYS = 1000;

async function startApp() {
  const snap = await getDocs(collection(db, "completed_days"));
  const completed = snap.docs.map(d => Number(d.id));

  count.textContent = completed.length;
  list.innerHTML = "";

  for (let i = 1; i <= TOTAL_DAYS; i++) {
    const date = new Date(START_DATE);
    date.setDate(date.getDate() + i - 1);

    const card = document.createElement("div");
    card.className = "card" + (completed.includes(i) ? " completed" : "");
    card.innerHTML = `
      <div>
        <h3>Day ${i}</h3>
        <p style="color:var(--muted)">${date.toDateString()}</p>
      </div>
      <div class="badge">Completed</div>
    `;

    card.onclick = async () => {
      if (card.classList.toggle("completed")) {
        await setDoc(doc(db,"completed_days",String(i)),{done:true});
        count.textContent++;
      } else {
        await deleteDoc(doc(db,"completed_days",String(i)));
        count.textContent--;
      }
    };

    list.appendChild(card);
  }
}
</script>

</body>
</html>